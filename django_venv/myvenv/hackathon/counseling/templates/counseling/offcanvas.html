{% load static %}
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
  <meta name="generator" content="Jekyll v4.1.1">
  <title>Offcanvas template Â· Bootstrap</title>

  <link rel="canonical" href="https://getbootstrap.com/docs/4.5/examples/offcanvas/">

  <!-- Bootstrap core CSS -->
  <link href="{% static 'assets/dist/css/bootstrap.min.css' %}" rel="stylesheet">

  <style>
    .bd-placeholder-img {
      font-size: 1.125rem;
      text-anchor: middle;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    @media (min-width: 768px) {
      .bd-placeholder-img-lg {
        font-size: 3.5rem;
      }
    }
  </style>
  <!-- Custom styles for this template -->
  <link href="{% static 'offcanvas.css' %}" rel="stylesheet">
</head>
<body class="bg-light">
  

  <nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-dark">
    <a class="navbar-brand mr-auto mr-lg-0" href="#">Offcanvas navbar</a>
    <button class="navbar-toggler p-0 border-0" type="button" data-toggle="offcanvas">
      <span class="navbar-toggler-icon"></span>
    </button>
  
    <div class="navbar-collapse offcanvas-collapse" id="navbarsExampleDefault">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" href="#">Dashboard <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Notifications</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Profile</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Switch account</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Settings</a>
          <div class="dropdown-menu" aria-labelledby="dropdown01">
            <a class="dropdown-item" href="#">Action</a>
            <a class="dropdown-item" href="#">Another action</a>
            <a class="dropdown-item" href="#">Something else here</a>
          </div>
        </li>
      </ul>
      <form class="form-inline my-2 my-lg-0">
        <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
        <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
      </form>
    </div>
  </nav>
  
  <div class="nav-scroller bg-white shadow-sm">
    <nav class="nav nav-underline">
      <a class="nav-link active" href="#">Dashboard</a>
      <a class="nav-link" href="#">
        Friends
        <span class="badge badge-pill bg-light align-text-bottom">27</span>
      </a>
      <a class="nav-link" href="#">Explore</a>
      <a class="nav-link" href="#">Suggestions</a>
      <a class="nav-link" href="#">Link</a>
      <a class="nav-link" href="#">Link</a>
      <a class="nav-link" href="#">Link</a>
      <a class="nav-link" href="#">Link</a>
      <a class="nav-link" href="#">Link</a>
    </nav>
  </div>

  <main role="main" class="container">
    <div class="d-flex align-items-center p-3 my-3 text-white-50 bg-purple rounded shadow-sm">
      <img class="mr-3" src="{% static 'assets/brand/bootstrap-outline.svg' %}" alt="" width="48" height="48">
      <div class="lh-100">
        <h6 class="mb-0 text-white lh-100">Bootstrap</h6>
        <small>Since 2011</small>
      </div>
    </div>

    <div class="my-3 p-3 bg-white rounded shadow-sm">
      <h6 class="border-bottom border-gray pb-2 mb-0">Lobby</h6>
      <div class="media text-muted pt-3">
        <svg class="bd-placeholder-img mr-2 rounded" width="32" height="32" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: 32x32"><title>Placeholder</title><rect width="100%" height="100%" fill="#007bff"></rect><text x="50%" y="50%" fill="#007bff" dy=".3em">32x32</text></svg>
        <p class="media-body pb-3 mb-0 small lh-125 border-bottom border-gray">
          <strong class="d-block text-gray-dark">Welcome! {{ user.username }}</strong>
          You can counsel about your worry with the counseler after submititng some informations and agreement.
        </p>
      </div>
      <small class="d-block text-right mt-3">
        Reason: <input id="reason" type="text"></input>
        <input id="apply" type="button" value="apply"></input>
      </small>
    </div>

    <div id="counseler" class="my-3 p-3 bg-white rounded shadow-sm">
      <h6 class="border-bottom border-gray pb-2 mb-0">Counseler</h6>
      <small class="d-block text-right mt-3">
        Message: <input id='counseler_message' type="text"></input>
        <input id="counseler_send" type="button" value="send"></input>
      </small>
    </div>

    <div id="counselee" class="my-3 p-3 bg-white rounded shadow-sm">
      <h6 class="border-bottom border-gray pb-2 mb-0">Counselee</h6>
      <small class="d-block text-right mt-3">
        Message: <input id="counselee_message" type="text"></input>
        <input id="counselee_send" type="button" value="send"></input>
      </small>
    </div>
  </main>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script>window.jQuery || document.write('<script src="../assets/js/vendor/jquery.slim.min.js"><\/script>')</script><script src="{% static 'assets/dist/js/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'offcanvas.js' %}"></script>
  <script>
    const chatSocket = new WebSocket(
      'ws://'
      +  window.location.host
      + '/ws/counseling/'
      );

    chatSocket.onmessage = function(e){
      const data = JSON.parse(e.data);
      const type = data['type']
      switch (type){
        case 'apply':
          var counseler = document.getElementById('counseler');
          var div = document.createElement('div');
          div.setAttribute('class', 'media text-muted pt-3');
          // div.innerHTML = '<svg class="bd-placeholder-img mr-2 rounded" width="32" height="32" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: 32x32"><title>Placeholder</title><rect width="100%" height="100%" fill="#007bff"></rect><text x="50%" y="50%" fill="#007bff" dy=".3em">32x32</text></svg>'
          var p = document.createElement('p');
          p.setAttribute('class', 'media-body pb-3 mb-0 small lh-125 border-bottom border-gray');
          var strong = document.createElement('strong');
          strong.setAttribute('class', 'd-block text-gray-dark');
          var text1 = document.createTextNode('Arrive application from ' + data['counselee']['name']);
          var text2 = document.createTextNode('The reason is that ' + data['reason']);
          var button = document.createElement('input');
          button.setAttribute('id', 'accept');
          button.setAttribute('value', 'accept');
          button.setAttribute('type', 'button');
          button.onclick = function(e){
            chatSocket.send(JSON.stringify({
              'type': 'accept_counsel'
            }))
            var counseler = document.getElementById('counseler');
            var div = document.createElement('div');
            div.setAttribute('class', 'media text-muted pt-3');
            var p = document.createElement('p');
            p.setAttribute('class', 'media-body pb-3 mb-0 small lh-125 border-bottom border-gray');
            var strong = document.createElement('strong');
            strong.setAttribute('class', 'd-block text-gray-dark');
            var text1 = document.createTextNode('Start');
            strong.appendChild(text1);
            p.appendChild(strong);
            div.appendChild(p);
            counseler.insertBefore(div, counseler.children[counseler.childElementCount-1]);
          };
          strong.appendChild(text1);
          p.appendChild(strong);
          p.appendChild(text2);
          div.appendChild(p);
          div.appendChild(button);
          counseler.insertBefore(div, counseler.children[counseler.childElementCount-1]);
          break;
        case 'accept_counsel':
          var counselee = document.getElementById('counselee');
          var div = document.createElement('div');
          div.setAttribute('class', 'media text-muted pt-3');
          var p = document.createElement('p');
          p.setAttribute('class', 'media-body pb-3 mb-0 small lh-125 border-bottom border-gray');
          var strong = document.createElement('strong');
          strong.setAttribute('class', 'd-block text-gray-dark');
          var text1 = document.createTextNode('Start');
          strong.appendChild(text1);
          p.appendChild(strong);
          div.appendChild(p);
          counselee.insertBefore(div, counselee.children[counselee.childElementCount-1]);
          break;
        case 'message':
          console.log(data['message'])
          break;
        default:
          break;
      }
    };

    document.querySelector('#apply').onclick = function(e){
      var counselee = document.getElementById('counselee');
      var div = document.createElement('div');
      div.setAttribute('class', 'media text-muted pt-3');
      var p = document.createElement('p');
      p.setAttribute('class', 'media-body pb-3 mb-0 small lh-125 border-bottom border-gray');
      var strong = document.createElement('strong');
      strong.setAttribute('class', 'd-block text-gray-dark');
      var text1 = document.createTextNode('Please waiting...');
      strong.appendChild(text1);
      p.appendChild(strong);
      div.appendChild(p);
      counselee.insertBefore(div, counselee.children[counselee.childElementCount-1]);
      const reason = document.querySelector('#reason').value;
      chatSocket.send(JSON.stringify({
        'type': 'apply',
        'reason': reason
      }))
    };
    document.querySelector('#counseler_send').onclick = function(e){
      const messageInputDom = document.querySelector('#counseler_message');
      chatSocket.send(JSON.stringify({
        'type': 'message',
        'message':message
      }))
    };
    document.querySelector('#counselee_send').onclick = function(e){
      const messageInputDom = document.querySelector('#counselee_message');
      chatSocket.send(JSON.stringify({
        'type': 'message',
        'message':message
      }))
    };
  </script>
</body>
</html>